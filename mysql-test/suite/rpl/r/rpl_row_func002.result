include/master-slave.inc
[connection master]
connection master;
DROP FUNCTION test.f1;
DROP TABLE IF EXISTS test.t1;
DROP TABLE IF EXISTS test.t2;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
CREATE TABLE test.t1 (a INT NOT NULL AUTO_INCREMENT, t TIMESTAMP, t2 TIMESTAMP, PRIMARY KEY(a));
SET sql_mode = DEFAULT;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
CREATE TABLE test.t2 (a INT NOT NULL AUTO_INCREMENT, t TIMESTAMP, t2 TIMESTAMP, PRIMARY KEY(a));
SET sql_mode = DEFAULT;
create function test.f1() RETURNS TIMESTAMP 
BEGIN
UPDATE test.t1 SET t  = CURRENT_TIMESTAMP;
RETURN CURRENT_TIMESTAMP;
END//
INSERT INTO test.t2 VALUES (null,f1(),CURRENT_TIMESTAMP);
SET TIMESTAMP=2;
INSERT INTO test.t2 VALUES (null,f1(),CURRENT_TIMESTAMP);
SET TIMESTAMP=1;
INSERT INTO test.t2 VALUES (null,f1(),CURRENT_TIMESTAMP);
SET TIMESTAMP=333300000;
INSERT INTO test.t2 VALUES (null,f1(),CURRENT_TIMESTAMP);
connection slave;
connection master;
DROP FUNCTION test.f1;
DROP TABLE test.t1;
DROP TABLE test.t2;
connection slave;
include/rpl_end.inc
